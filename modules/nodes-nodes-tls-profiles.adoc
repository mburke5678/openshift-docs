// Module included in the following assemblies:
//
// * nodes/clusters/nodes-nodes-tls.adoc

[id="nodes-nodes-tls-profiles_{context}"]
= About TLS profiles for the kubelet

When defining a TLS security profile for the kubelet HTTP server, you use the `tlsSecurityProfile` parameter in a `KubeletConfig` custom resource (CR) to specify a predefined or custom profile for specific nodes.

You can specify one of the following TLS security profile types:

* `Old`. This is a predefined profile intended for use with legacy clients or libraries. The profile is based on link:https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_configurations[recommended configurations].
+
The `Old` profile uses the following TLS cipher suites and requires a minimum TLS version of 1.0:
+
--
* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
* TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
* TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
* TLS_RSA_WITH_AES_128_GCM_SHA256
* TLS_RSA_WITH_AES_256_GCM_SHA384
* TLS_RSA_WITH_AES_128_CBC_SHA256
* TLS_RSA_WITH_AES_128_CBC_SHA
* TLS_RSA_WITH_AES_256_CBC_SHA
* TLS_RSA_WITH_3DES_EDE_CBC_SHA
--
+
.Sample `KubeletConfig` CR that configures the `Old` TLS security profile on worker nodes
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: set-kubelet-tls-old-profile
spec:
  tlsSecurityProfile:
    type: Old
  machineConfigPoolSelector:
    matchLabels:
      pools.operator.machineconfiguration.openshift.io/worker: ""
----

* `Intermediate`. This is a predefined profile, which is the default TLS security profile for the kubelet. The profile is based on link:https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_configurations[recommended configurations].
+
The `Intermediate` profile uses the following TLS cipher suites and requires a minimum TLS version of 1.2:
+
--
* TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
* TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
* TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,
* TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
--
+
.Sample `KubeletConfig` CR that configures the `Intermediate` TLS security profile on master nodes
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: set-kubelet-tls-intermediate-profile
spec:
  tlsSecurityProfile:
    type: Intermediate
  machineConfigPoolSelector:
    matchLabels:
      node-role.kubernetes.io/master= "" 
----

////
Not currently supported
https://github.com/openshift/machine-config-operator/pull/2324/files#diff-d65191d40b6cad37258f8a9cf4d7b9623f4ceb2a6197ef089a99a44f786b375bR358

* `Modern` Use with modern clients that support TLS 1.3 with no need for backwards compatibility.
+
.Sample `Modern` profile configuration
[source,yaml]
----
spec:
  tlsSecurityProfile:
    type: Modern
----
////

* `Custom`. This profile allows you to define the TLS ciphers and version to use.
+
[WARNING]
====
Use caution when using a `Custom` profile, because invalid configurations can cause problems.
====
+
.Sample `KubeletConfig` CR that configures a `Custom` TLS security profile on the master and worker nodes
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: set-kubelet-tls-custom-profile
spec:
  tlsSecurityProfile:
    type: Custom
    custom:
      ciphers: <1>
          - ECDHE-ECDSA-CHACHA20-POLY1305
          - ECDHE-RSA-CHACHA20-POLY1305
          - ECDHE-RSA-AES128-GCM-SHA256
          - ECDHE-ECDSA-AES128-GCM-SHA256
      minTLSVersion: VersionTLS12 <2>
  machineConfigPoolSelector:
    matchLabels:
      pools.operator.machineconfiguration.openshift.io/worker: ""
      node-role.kubernetes.io/master= ""
----
+
<1> A prioritized list of TLS ciphers.
<2> The minimum accepted TLS version.

You can see the current TLS ciphers being used by viewing the `/etc/kubernetes/kubelet.conf` file on any node that is configured with a TLS profile.

.Sample from a `kubelet.conf` file configured with a `Custom` TLS profile
[source,terminal]
----
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
 ...
  "tlsCipherSuites": [
    "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
    "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
    "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384",
    "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
    "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",
    "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256"
  ],
  "tlsMinVersion": "VersionTLS12",
 ...
----

