[[dev-guide-templates-self-provision]]
= Creating Pre-Populated Project Templates
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]


== Overview

//https://access.redhat.com/support/cases/#/case/01503177
One workflow that you can implement with templates is to create _read-only_ default project templates that include restrictions on quotas, limits, and other resources you do not want template users changing.

Along with the project templates, you can create multiple application templates also configured with quota/limit restrictions. Standard users do not have authorization to 
edit templates, so the limits you specify cannot be changed.

As a administrator, you can control limits and quotas through templates. Users would only need to select the template when creating applications. 

This topic includes the following:
 
- How to set up a default project template and multiple project templates that can be called on by the user. 
- Examples on to add Resource Quotas, RangeLimits, and so forth to these templates. 
- Steps on how a system administrator can restrict users from editing preset objects but still allow the user administrator control over the project. 

//From https://access.redhat.com/support/cases/#/case/01503177

[[dev-guide-templates-edit-project]]
== Creating a Project Template that Cannot be Edited by a Non-Admin User

A system administrator can create a new project with hard ResourceQuotas, LimitRanges, and so forth. -

//https://access.redhat.com/support/cases/#/case/01503177
For each template, you can specify:
https://docs.openshift.com/enterprise/3.0/dev_guide/quota.html#usage-limits

* CPU

* memory

* pods

* replication controllers

* resource quotas

* services

* secrets

* persistent volume claims

For specific examples, you can also see xref:../../admin_guide/quota.adoc#sample-resource-quota-definitions[Sample Resource Quota Definitions] 

Users are not able to edit these settings even if they have created the project but still have project administrator control. 

=== Create a Project Template

Create a role, such as `my-project-admin-role`, with access to resources pods, replicationcontrollers, 
deploymentconfigs, builds, and add a rolebinding to bind the the ${PROJECT_ADMIN_USER} to this role in the template. 
Role bindings give a user a certain role in a project and grant that user project access.

. Create a project template based on the default project template: 
+
----
$ oadm create-bootstrap-project-template -o json/yaml > <template-name>
----
+
For example, the following command exports the default project template
to a file named _*myproject.yaml*_:
+
----
$ oc adm create-bootstrap-project-template -o yaml > myproject.yaml 
----

. Edit the new project template file to change the `RoleBinding`:
+
[source,yaml]
----
"kind": "RoleBinding",
"apiVersion": "v1",
"metadata": {
    "name": "admin",
    "namespace": "${PROJECT_NAME}", <1>
    "creationTimestamp": null
    },
   "userNames": [
       "${PROJECT_ADMIN_USER}" <2>
   ],
   "groupNames": null,
   "subjects": [
       {
           "kind": "User",
           "name": "${PROJECT_ADMIN_USER}"
       }
   ],
   "roleRef": {
       "name": "admin"
----
+
<1> Specify the name of the project you want to limit access to.
<2> specify the name of an admin user you want to be able to access to the template.
+
When a project request is submitted, the API substitutes the following parameters into the template:
+
[cols="4,8",options="header"]
|===
|Parameter |Description

|*PROJECT_NAME*
|The name of the project. Required.

|*PROJECT_DISPLAYNAME*
|The display name of the project. May be empty.

|*PROJECT_DESCRIPTION*
|The description of the project. May be empty.

|*PROJECT_ADMIN_USER*
|The username of the administrating user.

|*PROJECT_REQUESTING_USER*
|The username of the requesting user.
|===

. Create a `RoleBinding` object: 


[[modifying-templates-for-new-projects]]
=== Configure a New Default Template

//tag::admin-guide-managing-projects-template[]
The API server automatically provisions projects based on the template that is
identified by the `projectRequestTemplate` parameter of the *_master-config.yaml_*
file. If the parameter is not defined, the API server creates a default template
that creates a project with the requested name, and assigns the requesting user
to the *admin* role for that project.

Access to the API is granted to developers with the
xref:../architecture/additional_concepts/authorization.adoc#roles[`self-provisioner`
role] and the `self-provisioners` cluster role binding. This role is available
to all authenticated developers by default.

//https://access.redhat.com/support/cases/#/case/01503177
To create your own custom project template:

. Modify the *_/etc/origin/master/master-config.yaml_* file to reference the project template you want as the default:
+
----
...
projectConfig:
  projectRequestTemplate: "default/myproject"
  ...
----
+
For example:
+
----
...
projectConfig:
  projectRequestTemplate: "default/<name>"
  ...
----

. Use a text editor to modify the *_template.yaml_* file by adding objects or modifying existing objects.

. Restart {product-title} for the changes to take
effect.
ifdef::openshift-origin[]
----
# systemctl restart origin-master
----
endif::[]
ifdef::openshift-enterprise[]
----
# systemctl restart atomic-openshift-master
----
endif::[]

. Load the template:
+
----
$ oc create -f template.yaml -n default
----
+
Configure the templates using the following sections.


//end::admin-guide-managing-projects-template[]

[[admin-guide-templates-edit-project-containers]]
=== Limiting the Number of Replicas or Containers 

You can limit the number of containers that can be created with a specific template by adding a *ResourceQuota* object to the template.

include::admin_guide/quota.adoc[tag=admin_quota_compute_resources]

For more information on requsource quotas, see xref:../../admin_guide/quota.adoc#admin-guide-quota[Setting Quotas].

[[dev-guide-templates-edit-project-size]]
=== Limiting the Size of Containers

You can control the size of the containers created with a specific template by adding a LimitRange object to the template.

include::admin_guide/limits.adoc[tag=admin_limits_sample_definitions]

For more information on limit ranges, see xref:../../admin_guide/limits.adoc#admin-guide-limits[Setting Limit Ranges].

[[dev-guide-templates-edit-project-volume]]
=== Limiting Persistent Volume Usage

include::dev_guide/templates/templates_edit.adoc[tag=template-limit-volume]

== Assigning Permissions
//https://access.redhat.com/support/cases/#/case/01503177
The project templates will be defined by the platform administrators. 

By default a project admin does not have Authorization create or edit resource limits. Only `cluster-admin` have access to create and edit these. 

* To allow users to create a project then when they do they become admin of that project: 
+
----
# oc new-project <project-name>
# oc get rolebinding
----

== Create Application Templates 



[[dev-guide-templates-edit-project-disable]]
=== Disabling Self-provisioning

include::admin_guide/managing_projects.adoc[tag=admin-guide-managing-projects-template-disable]


