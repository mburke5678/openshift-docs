[[dev-guide-templates-using]]
= Creating Objects Using Templates
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]


== Overview

//tag::default-templates[]
{product-title} provides a number of default and Instant App and Quickstart templates
to make it easy to quickly get started creating a new application for different
languages. Templates are provided for Rails (Ruby), Django (Python), Node.js,
CakePHP (PHP), and Dancer (Perl). Your cluster administrator should have 
xref:../../dev_guide/templates/templates_load.adoc#dev-guide-templates-loading[created
these templates] in the default, global *openshift* project so you have access to
them.  

The default templates are located in *_/usr/share/openshift/examples/xpaas-templates_*.
//end::default-templates[]

Alternatively, you can xref:../../dev_guide/templates/templates_create.adoc#dev-guide-templates-creating[create your own templates], either from scratch or based on
existing templates.

Once your templates are in place, you can use xref:dev-guide-templates-using-web[the web console] 
or xref:dev-guide-templates-using-cli[the {product-title} CLI] to create objects from a template.

[[dev-guide-templates-using-project]]
== Loading Templates into a Project

include::dev_guide/templates/templates_load.adoc[tag=templates-loading-project]

[[using-the-instantapp-templates]]
== Using the Instant App and Quickstart Templates
{product-title} provides a number of default Instant App and Quickstart templates to
make it easy to quickly get started creating a new application for different
languages. Templates are provided for Rails (Ruby), Django (Python), Node.js,
CakePHP (PHP), and Dancer (Perl). Your cluster administrator should have created
these templates in the default, global *openshift* project so you have access to
them. 


ifdef::openshift-enterprise,openshift-origin[]
If they are not available, direct your cluster administrator to the
xref:../install_config/imagestreams_templates.adoc#install-config-imagestreams-templates[Loading the Default Image Streams and Templates]
topic.
endif::[]

[NOTE]
====
Some of the Instant App and Quickstart templates define a database
xref:../architecture/core_concepts/deployments.adoc#deployments-and-deployment-configurations[deployment configuration].
The configuration they define uses ephemeral storage for the database content.
These templates should be used for demonstration purposes only as all database
data will be lost if the database pod restarts for any reason.
====

[[dev-guide-templates-using-inspect]]
== Inspecting a template

Before using a template, we need to know:

* the template name
* the description of the template
* the expected parameters

[[dev-guide-templates-using-list]]

=== List all the available templates
For viewing all the available templates for use (using the CLI) we will have to list the templates in the "openshift” project and in the user’s current project.

----
# oc get templates -n openshift
# oc get templates
---- 
From this list, we will get the name of the template we want to use.

[[dev-guide-templates-using-describe]]
=== Inspect a template

We need more information about the template, so we are going to describe the template:

----
# oc describe template mlbparks

Name:    mlbparks
Created: 7 days ago
Labels:     <none>
Description:   Application template for MLB Parks application on EAP 6 & MongoDB built using STI
Annotations:   iconClass=icon-jboss

Parameters:
    Name:      EAP_RELEASE
    Description:  EAP Release version, e.g. 6.4, etc.
    Value:     6.4
    Name:      APPLICATION_NAME
    Description:  The name for the application.
    Value:     mlbparks
    Name:      APPLICATION_HOSTNAME
    Description:  Custom hostname for service routes.
    Value:     <none>
    Name:      GIT_URI
    Description:  Git source URI for application
    Value:     https://github.com/jorgemoralespou/openshift3mlbparks.git  +++++++CHANGE THIS+++++
    Name:      GIT_REF
    Description:  Git branch/tag reference
    Value:     master
    Name:      MONGODB_DATABASE
    Description:  Database name
    Value:     root
    Name:      MONGODB_NOPREALLOC
    Description:  Disable data file preallocation.
    Value:     <none>
    Name:      MONGODB_SMALLFILES
    Description:  Set MongoDB to use a smaller default data file size.
    Value:     <none>
    Name:      MONGODB_QUIET
    Description:  Runs MongoDB in a quiet mode that attempts to limit the amount of output.
    Value:     <none>
    Name:      MONGODB_USER
    Description:  Database user name
    Generated:    expression
    From:      user[a-zA-Z0-9]{3}

    Name:      MONGODB_PASSWORD
    Description:  Database user password
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      MONGODB_ADMIN_PASSWORD
    Description:  Database admin password
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      GITHUB_TRIGGER_SECRET
    Description:  Github trigger secret
    Generated:    expression
    From:      [a-zA-Z0-9]{8}

    Name:      GENERIC_TRIGGER_SECRET
    Description:  Generic build trigger secret
    Generated:    expression
    From:      [a-zA-Z0-9]{8}


Object Labels: template=mlbparks

Objects:
    BuildConfig      ${APPLICATION_NAME}
    ImageStream      ${APPLICATION_NAME}
    DeploymentConfig ${APPLICATION_NAME}-mongodb
    DeploymentConfig ${APPLICATION_NAME}
    Route      ${APPLICATION_NAME}-http-route
    Service    mongodb
    Service    ${APPLICATION_NAME}-http
    Service    ${APPLICATION_NAME}-ping
----

[[dev-guide-templates-using-web]]
== Creating Objects Using the Web Console
//tag::creating-templates-web[]
To create a object from an existing template using the web console:

. While in the desired project, click *Add to Project*:
+
image::console_create.png["Console Create"]

. Select the programming language.
+
image::console_select_image_or_template.png["Select Template"]
+
Tiles for the available images and templates is displayed. Tiles with the words 
_Builds source code_ are images. 

. Select a template to edit.

. Modify template parameters in the template creation screen:
+
image::create_from_template.png["Create from Template"]
+
<1> Template name and description.
<2> Container images included in the template.
<3> Parameters defined by the template. You can edit values for parameters
defined in the template here.
<4> xref:templates-labels[Labels] to assign to all items included in the
template. You can add and edit labels for objects.
//end::creating-templates-web[]


[[dev-guide-templates-using-cli]]
== Using the CLI
//tag::creating-templates-cli[]

You can use the CLI to process templates and use the configuration that is
generated to create objects. process

The `oc project` command transforms a project template into a project configuration file.

. If necessary, run the following command to view the available commands:
+
----
oc get templates -n openshift
----

. Optionally, change the label. xref:../architecture/core_concepts/pods_and_services.adoc#labels[Labels] are
used to manage and organize generated objects, such as pods. The labels
specified in the template are applied to every object that is generated from
the template.
+
----
$ oc process -f <project. <filename> -l name=otherLabel
----

. Edit any of the available parameters.
+
The list of parameters that you can override are listed in the
xref:writing-parameters[`parameters` section of the template]. You can list them
with the CLI by using the following command and specifying the file to be used:
+
----
$ oc process --parameters -f <filename>
----
+
Alternatively, if the template is already uploaded:
+
----
$ oc process --parameters -n <project> <template_name>
----
+
For example, the following shows the output when listing the parameters for one
of the Quickstart templates in the default *openshift* project:
+
----
$ oc process --parameters -n openshift rails-postgresql-example

NAME                         DESCRIPTION                                                                                                 GENERATOR           VALUE
NAME                         The name assigned to all of the frontend objects defined in this template.                                                      rails-postgresql-example
NAMESPACE                    The OpenShift Namespace where the ImageStream resides.                                                                          openshift
MEMORY_LIMIT                 Maximum amount of memory the Rails container can use.                                                                           512Mi
MEMORY_POSTGRESQL_LIMIT      Maximum amount of memory the PostgreSQL container can use.                                                                      512Mi
SOURCE_REPOSITORY_URL        The URL of the repository with your application source code.                                                                    https://github.com/openshift/rails-ex.git
SOURCE_REPOSITORY_REF        Set this to a branch name, tag or other ref of your repository if you are not using the default branch.                         
CONTEXT_DIR                  Set this to the relative path to your project if it is not in the root of your repository.                                      
APPLICATION_DOMAIN           The exposed hostname that will route to the Rails service, if left blank a value will be defaulted.                             
GITHUB_WEBHOOK_SECRET        Github trigger secret.  A difficult to guess string encoded as part of the webhook URL.  Not encrypted.     expression          [a-zA-Z0-9]{40}
SECRET_KEY_BASE              Your secret key for verifying the integrity of signed cookies.                                              expression          [a-z0-9]{127}
APPLICATION_USER             The application user that is used within the sample application to authorize access on pages.                                   openshift
APPLICATION_PASSWORD         The application password that is used within the sample application to authorize access on pages.                               secret
RAILS_ENV                    Environment under which the sample application will run. Could be set to production, development or test.                       production
DATABASE_SERVICE_NAME                                                                                                                                        postgresql
DATABASE_USER                                                                                                                            expression          user[A-Z0-9]{3}
DATABASE_PASSWORD                                                                                                                        expression          [a-zA-Z0-9]{8}
DATABASE_NAME                                                                                                                                                root
POSTGRESQL_MAX_CONNECTIONS                                                                                                                                   100
POSTGRESQL_SHARED_BUFFERS                                                                                                                                    12MB
RUBYGEM_MIRROR               The custom RubyGems mirror URL                                                                                                  

----
+
For example, the following command creats a JSON file based on the *rails-postgresql-example* template. The new configuration
whas a new name and memory limit:
+
----
$ oc process -f openshift rails-postgresql-example -l name=rails-postgresql-example-small -p MEMORY_LIMIT=256Mi -p MEMORY_POSTGRESQL_LIMIT=256Mi
----
+
See _Example Template Files_ for xref:../../dev-guide/templates/templates_example#dev-guide-templates-example-edited[the output of this command].

[[generating-a-list-of-objects]]

=== Generating a List of Objects
Using the CLI, you can process a file defining a template to return the list of objects to standard output:

----
$ oc process -f <filename>
----

Alternatively, if the template has already been uploaded to the current project:

----
$ oc process <template_name>
----

You can create objects from a template by processing the template and piping the
output to `oc create`:

----
$ oc process -f <filename> | oc create -f -
----

Alternatively, if the template has already been uploaded to the current project:

----
$ oc process <template> | oc create -f -
----

You can override any
xref:../dev_guide/templates.adoc#templates-parameters[parameter] values defined
in the file by adding the `-p` option for each `<name>=<value>` pair you want
to override. A parameter reference may appear in any text field inside the
template items.

For example, in the following the *`POSTGRESQL_USER`* and *`POSTGRESQL_DATABASE`*
parameters of a template are overridden to output a configuration with
customized environment variables:

.Creating a List of Objects from a Template
====
----
$ oc process -f my-rails-postgresql \
    -p POSTGRESQL_USER=bob \
    -p POSTGRESQL_DATABASE=mydatabase
----
====

The JSON file can either be redirected to a file or applied directly without
uploading the template by piping the processed output to the `oc create`
command:

====
----
$ oc process -f my-rails-postgresql \
    -p POSTGRESQL_USER=bob \
    -p POSTGRESQL_DATABASE=mydatabase \
    | oc create -f -
----
====

If you have large number of parameters, you can store them in a file and then
pass this file to `oc process`:

----
$ cat postgres.env
POSTGRESQL_USER=bob
POSTGRESQL_DATABASE=mydatabase
$ oc process -f my-rails-postgresql --param-file=postgres.env
----

You can also read the environment from standard input by using `"-"` as the
argument to `--param-file`:

----
$ sed s/bob/alice/ postgres.env | oc process -f my-rails-postgresql --param-file=-
----
//end::creating-templates-cli[]

